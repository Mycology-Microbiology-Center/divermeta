<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to divermeta • divermeta</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to divermeta">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">divermeta</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/divermeta.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to divermeta</h1>
                        <h4 data-toc-skip class="author">Felipe
González-Casabianca, Vladimir Mikryukov</h4>
            
            <h4 data-toc-skip class="date">2025-11-30</h4>
      

      <div class="hidden name"><code>divermeta.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>divermeta</code> computes multiplicity, the metric that
quantifies within‑cluster diversity that is typically neglected when
elements are grouped into units (e.g., genes into homolog groups, ASVs
into OTUs, etc.).</p>
<p>The core funcion of the package is <code><a href="../reference/divermeta.html">divermeta()</a></code>, which
computes multiple indices across all samples at once. You may request
the following indices via <code>indices</code> argument:</p>
<ul>
<li>inventory multiplicity: <code>"multiplicity_inventory"</code>
</li>
<li>distance‑based multiplicity (σ‑capped):
<code>"multiplicity_distance"</code>
</li>
<li>optional companions: <code>"raoQ"</code>, <code>"FD_sigma"</code>,
<code>"FD_q"</code>, <code>"redundancy"</code>
</li>
</ul>
<p>Additionally, the package provides
<code><a href="../reference/metagenomic.alpha.index.html">metagenomic.alpha.index()</a></code> (MAD) as a standalone function
for computing the Metagenomic Alpha-Diversity Index (see below).</p>
<p>This vignette uses tiny synthetic data to keep runtime short and
outputs deterministic.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of divermeta from GitHub
with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Mycology-Microbiology-Center/divermeta"</span><span class="op">)</span></span></code></pre></div>
<p>Load the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">divermeta</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<p>We create a small features x samples abundance matrix, a cluster
membership vector aligned by feature names, and a feature dissimilarity
matrix in the 0-1 range.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Features (rows) and samples (columns)</span></span>
<span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f1"</span>, <span class="st">"f2"</span>, <span class="st">"f3"</span>, <span class="st">"f4"</span><span class="op">)</span></span>
<span><span class="va">samples</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"S3"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">abund</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">10</span>,  <span class="fl">4</span>,  <span class="fl">0</span>,  <span class="co"># f1</span></span>
<span>     <span class="fl">0</span>,  <span class="fl">9</span>,  <span class="fl">6</span>,  <span class="co"># f2</span></span>
<span>     <span class="fl">5</span>,  <span class="fl">3</span>,  <span class="fl">7</span>,  <span class="co"># f3</span></span>
<span>     <span class="fl">6</span>,  <span class="fl">0</span>, <span class="fl">12</span>   <span class="co"># f4</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">features</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">features</span>, <span class="va">samples</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clusters per feature (named, aligned to rownames(abund))</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>f1 <span class="op">=</span> <span class="st">"A"</span>, f2 <span class="op">=</span> <span class="st">"A"</span>, f3 <span class="op">=</span> <span class="st">"B"</span>, f4 <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional dissimilarity among features (0-1); names must match abund rownames</span></span>
<span><span class="va">diss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">0.0</span>, <span class="fl">0.2</span>, <span class="fl">0.7</span>, <span class="fl">1.0</span>,</span>
<span>    <span class="fl">0.2</span>, <span class="fl">0.0</span>, <span class="fl">0.6</span>, <span class="fl">0.9</span>,</span>
<span>    <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="fl">0.0</span>, <span class="fl">0.4</span>,</span>
<span>    <span class="fl">1.0</span>, <span class="fl">0.9</span>, <span class="fl">0.4</span>, <span class="fl">0.0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">features</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">features</span>, <span class="va">features</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># One call computes multiple indices across all samples</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divermeta.html">divermeta</a></span><span class="op">(</span></span>
<span>  <span class="va">abund</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>  diss     <span class="op">=</span> <span class="va">diss</span>,</span>
<span>  q        <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  sig      <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  indices  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"multiplicity_inventory"</span>, <span class="st">"multiplicity_distance"</span>, <span class="st">"raoQ"</span>, <span class="st">"redundancy"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span></span>
<span><span class="co">#&gt;   Sample multiplicity_inventory multiplicity_distance      raoQ redundancy</span></span>
<span><span class="co">#&gt; 1     S1               1.434634              1.085995 0.4852608  0.1496599</span></span>
<span><span class="co">#&gt; 2     S2               1.651211              1.008499 0.2484375  0.3375000</span></span>
<span><span class="co">#&gt; 3     S3               1.648991              1.188623 0.3955200  0.2380800</span></span></code></pre></div>
<p>Columns correspond to requested indices; rows correspond to samples.
Inventory multiplicity reflects the average within‑cluster diversity;
distance‑based multiplicity reflects average within‑cluster functional
or phylogenetic diversity with distances capped at a threshold sigma
(<code>σ</code>).</p>
<p>You can visualize the input data structures side-by-side:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_abundance.html">visualize_abundance</a></span><span class="op">(</span><span class="va">abund</span>, csize <span class="op">=</span> <span class="fl">0.7</span>, clegend <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/visualize_dist.html">visualize_dist</a></span><span class="op">(</span><span class="va">diss</span>, csize <span class="op">=</span> <span class="fl">0.7</span>, clegend <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="divermeta_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" width="50%"><img src="divermeta_files/figure-html/unnamed-chunk-4-2.png" class="r-plt" width="50%"></p>
<p>The left plot shows the abundance matrix (features x samples), where
tile size represents abundance magnitude. The right plot shows the
distance matrix (pairwise distances between features), where tile size
represents distance magnitude. Features f1-f2 belong to cluster A, and
f3-f4 belong to cluster B. Notice how within-cluster distances (f1-f2,
f3-f4) are smaller than between-cluster distances.</p>
</div>
<div class="section level2">
<h2 id="about-multiplicity-index">About multiplicity index<a class="anchor" aria-label="anchor" href="#about-multiplicity-index"></a>
</h2>
<p>TODO - brief intro + figure 1 &amp; 2 (a bit reworked)</p>
<p>Here we illustrate the multiplicity index concept using two samples
with the same cluster structure:</p>
<ul>
<li>High: multiple subunits per cluster (higher within‑cluster
diversity)</li>
<li>Low: only one representative per cluster (lower within‑cluster
diversity)</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reuse `features` and `clusters` from above</span></span>
<span><span class="va">abund_concept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">10</span>, <span class="fl">10</span>,  <span class="co"># f1 (A, representative)</span></span>
<span>    <span class="fl">10</span>,  <span class="fl">0</span>,  <span class="co"># f2 (A, additional subunit present only in High)</span></span>
<span>    <span class="fl">12</span>, <span class="fl">12</span>,  <span class="co"># f3 (B, representative)</span></span>
<span>     <span class="fl">8</span>,  <span class="fl">0</span>   <span class="co"># f4 (B, additional subunit present only in High)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">features</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">features</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"High"</span>,<span class="st">"Low"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">concept_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divermeta.html">divermeta</a></span><span class="op">(</span></span>
<span>  <span class="va">abund_concept</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>  indices  <span class="op">=</span> <span class="st">"multiplicity_inventory"</span>,</span>
<span>  q        <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">concept_res</span></span>
<span><span class="co">#&gt;   Sample multiplicity_inventory</span></span>
<span><span class="co">#&gt; 1   High               1.979966</span></span>
<span><span class="co">#&gt; 2    Low               1.000000</span></span></code></pre></div>
<p>As expected, <code>High</code> shows a larger multiplicity value than
<code>Low</code>, since each cluster contains more distinct
subunits.</p>
<p>Visualizing the abundance matrices side-by-side helps illustrate the
difference:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_abundance.html">visualize_abundance</a></span><span class="op">(</span><span class="va">abund_concept</span><span class="op">[</span>, <span class="st">"High"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, </span>
<span>                    sample.labels <span class="op">=</span> <span class="st">"High multiplicity"</span>,</span>
<span>                    csize <span class="op">=</span> <span class="fl">0.8</span>, clegend <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/visualize_abundance.html">visualize_abundance</a></span><span class="op">(</span><span class="va">abund_concept</span><span class="op">[</span>, <span class="st">"Low"</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, </span>
<span>                    sample.labels <span class="op">=</span> <span class="st">"Low multiplicity"</span>,</span>
<span>                    csize <span class="op">=</span> <span class="fl">0.8</span>, clegend <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="divermeta_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" width="50%"><img src="divermeta_files/figure-html/unnamed-chunk-6-2.png" class="r-plt" width="50%"></p>
<p>In the <strong>High</strong> scenario (left), both clusters (A:
f1+f2, B: f3+f4) contain multiple distinct features with non-zero
abundances, resulting in higher multiplicity. In the
<strong>Low</strong> scenario (right), each cluster effectively contains
only one feature (f2 and f4 have zero abundance), resulting in lower
multiplicity. The tile size represents abundance magnitude.</p>
<div class="section level3">
<h3 id="inventory-multiplicity">Inventory multiplicity<a class="anchor" aria-label="anchor" href="#inventory-multiplicity"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_q0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divermeta.html">divermeta</a></span><span class="op">(</span></span>
<span>  <span class="va">abund</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>  indices  <span class="op">=</span> <span class="st">"multiplicity_inventory"</span>,</span>
<span>  q        <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divermeta.html">divermeta</a></span><span class="op">(</span></span>
<span>  <span class="va">abund</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>  indices  <span class="op">=</span> <span class="st">"multiplicity_inventory"</span>,</span>
<span>  q        <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divermeta.html">divermeta</a></span><span class="op">(</span></span>
<span>  <span class="va">abund</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>  indices  <span class="op">=</span> <span class="st">"multiplicity_inventory"</span>,</span>
<span>  q        <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  Sample <span class="op">=</span> <span class="va">res_q1</span><span class="op">$</span><span class="va">Sample</span>,</span>
<span>  M_q0   <span class="op">=</span> <span class="va">res_q0</span><span class="op">$</span><span class="va">multiplicity_inventory</span>,</span>
<span>  M_q1   <span class="op">=</span> <span class="va">res_q1</span><span class="op">$</span><span class="va">multiplicity_inventory</span>,</span>
<span>  M_q2   <span class="op">=</span> <span class="va">res_q2</span><span class="op">$</span><span class="va">multiplicity_inventory</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Sample M_q0  M_q1               M_q2              </span></span>
<span><span class="co">#&gt; [1,] "S1"   "1.5" "1.43463376571196" "1.37267080745342"</span></span>
<span><span class="co">#&gt; [2,] "S2"   "1.5" "1.65121096664765" "1.67924528301887"</span></span>
<span><span class="co">#&gt; [3,] "S3"   "1.5" "1.64899100795382" "1.73362445414847"</span></span></code></pre></div>
<p><code>q</code> controls abundance weighting (0 richness‑like, 1
Shannon‑type, 2 Simpson‑type). Higher <code>q</code> down‑weights rare
subunits.</p>
</div>
<div class="section level3">
<h3 id="distancebased-multiplicity">Distance‑based multiplicity<a class="anchor" aria-label="anchor" href="#distancebased-multiplicity"></a>
</h3>
<p>Distance‑based multiplicity requires a dissimilarity matrix and uses
Shannon‑type weighting. Use <code>sig</code> to cap pairwise distances
and define when two subunits are considered distinct.</p>
<p>The distance matrix structure is key to understanding distance-based
multiplicity. Here’s the distance matrix from our example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_dist.html">visualize_dist</a></span><span class="op">(</span><span class="va">diss</span>, csize <span class="op">=</span> <span class="fl">0.8</span>, clegend <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="divermeta_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" width="480"></p>
<p>Notice how features within the same cluster (f1-f2 in cluster A,
f3-f4 in cluster B) have smaller distances (smaller squares) compared to
distances between clusters. Distance-based multiplicity quantifies the
diversity within clusters while accounting for these
functional/phylogenetic similarities.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_sig08</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divermeta.html">divermeta</a></span><span class="op">(</span></span>
<span>  <span class="va">abund</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>  diss     <span class="op">=</span> <span class="va">diss</span>,</span>
<span>  indices  <span class="op">=</span> <span class="st">"multiplicity_distance"</span>,</span>
<span>  sig      <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_sig10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divermeta.html">divermeta</a></span><span class="op">(</span></span>
<span>  <span class="va">abund</span>,</span>
<span>  clusters <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>  diss     <span class="op">=</span> <span class="va">diss</span>,</span>
<span>  indices  <span class="op">=</span> <span class="st">"multiplicity_distance"</span>,</span>
<span>  sig      <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">res_sig08</span>, <span class="va">res_sig10</span>, by <span class="op">=</span> <span class="st">"Sample"</span>, suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_sig0.8"</span>,<span class="st">"_sig1.0"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sample multiplicity_distance_sig0.8 multiplicity_distance_sig1.0</span></span>
<span><span class="co">#&gt; 1     S1                     1.085995                    0.9735683</span></span>
<span><span class="co">#&gt; 2     S2                     1.008499                    0.9251559</span></span>
<span><span class="co">#&gt; 3     S3                     1.188623                    1.0508205</span></span></code></pre></div>
<p>Smaller <code>sig</code> trims large distances, making subunits more
similar and lowering functional/phylogenetic diversity; this typically
increases distance‑based multiplicity (less diversity lost to
clustering, relatively more within‑cluster similarity accounted
for).</p>
</div>
<div class="section level3">
<h3 id="metagenomic-alpha-diversity-index-mad">Metagenomic Alpha-Diversity Index (MAD)<a class="anchor" aria-label="anchor" href="#metagenomic-alpha-diversity-index-mad"></a>
</h3>
<p>The Metagenomic Alpha-Diversity Index (MAD) is another metric for
measuring within-cluster diversity. Unlike multiplicity indices, MAD
does not incorporate element abundances and decreases as cluster size
increases. It is available as a standalone function
<code><a href="../reference/metagenomic.alpha.index.html">metagenomic.alpha.index()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute MAD</span></span>
<span><span class="co"># Note: MAD requires clusters and dissimilarity matrix, but doesn't use abundances</span></span>
<span><span class="co"># Since it doesn't use abundances, the value is the same regardless of sample</span></span>
<span><span class="va">mad_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metagenomic.alpha.index.html">metagenomic.alpha.index</a></span><span class="op">(</span></span>
<span>  clust <span class="op">=</span> <span class="va">clusters</span>,</span>
<span>  diss <span class="op">=</span> <span class="va">diss</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mad_value</span></span>
<span><span class="co">#&gt; [1] 0.575</span></span></code></pre></div>
<p><strong>Note</strong>: Unlike multiplicity, MAD does not account for
element abundances and behaves differently as cluster size increases.
See the manuscript for a detailed comparison between MAD and
multiplicity indices.</p>
</div>
</div>
<div class="section level2">
<h2 id="practical-tips">Practical tips<a class="anchor" aria-label="anchor" href="#practical-tips"></a>
</h2>
<ul>
<li>Ensure <code>clusters</code> is aligned to
<code>rownames(abund)</code>; a named vector is the most robust.</li>
<li>Provide <code>diss</code> scaled to 0-1. Values above
<code>sig</code> are capped internally.</li>
<li>Choose <code>q</code> to emphasize common vs. rare subunits;
distance‑based multiplicity is fixed to Shannon‑type weighting.</li>
</ul>
</div>
<div class="section level2">
<h2 id="importing-data-from-thirdparty-tools-todo">Importing data from third‑party tools (TODO)<a class="anchor" aria-label="anchor" href="#importing-data-from-thirdparty-tools-todo"></a>
</h2>
<p>TODO - add recipes on importing outputs from common pipelines/tools
and preparing data for <code><a href="../reference/divermeta.html">divermeta()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-redhat-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Fedora Linux 43 (KDE Plasma Desktop Edition)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS/LAPACK: FlexiBLAS OPENBLAS-OPENMP;  LAPACK version 3.12.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8    LC_NUMERIC=C            LC_TIME=C              </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=en_US.UTF-8  LC_MONETARY=en_US.UTF-8 LC_MESSAGES=en_US.UTF-8</span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C              LC_NAME=C               LC_ADDRESS=C           </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C          LC_MEASUREMENT=C        LC_IDENTIFICATION=C    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: Europe/Tallinn</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] divermeta_0.0.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] vctrs_0.6.5        cli_3.6.5          knitr_1.50         rlang_1.1.6       </span></span>
<span><span class="co">#&gt;  [5] xfun_0.54          generics_0.1.4     S7_0.2.1           textshaping_1.0.4 </span></span>
<span><span class="co">#&gt;  [9] jsonlite_2.0.0     glue_1.8.0         htmltools_0.5.8.1  ragg_1.5.0        </span></span>
<span><span class="co">#&gt; [13] sass_0.4.10        scales_1.4.0       rmarkdown_2.30     grid_4.5.2        </span></span>
<span><span class="co">#&gt; [17] tibble_3.3.0       evaluate_1.0.5     jquerylib_0.1.4    fastmap_1.2.0     </span></span>
<span><span class="co">#&gt; [21] yaml_2.3.10        lifecycle_1.0.4    compiler_4.5.2     dplyr_1.1.4       </span></span>
<span><span class="co">#&gt; [25] RColorBrewer_1.1-3 fs_1.6.6           pkgconfig_2.0.3    htmlwidgets_1.6.4 </span></span>
<span><span class="co">#&gt; [29] rstudioapi_0.17.1  farver_2.1.2       systemfonts_1.3.1  digest_0.6.39     </span></span>
<span><span class="co">#&gt; [33] R6_2.6.1           tidyselect_1.2.1   pillar_1.11.1      magrittr_2.0.4    </span></span>
<span><span class="co">#&gt; [37] bslib_0.9.0        withr_3.0.2        tools_4.5.2        gtable_0.3.6      </span></span>
<span><span class="co">#&gt; [41] pkgdown_2.2.0      ggplot2_4.0.1      cachem_1.1.0       desc_1.4.3</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Felipe González-Casabianca, Vladimir Mikryukov.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
